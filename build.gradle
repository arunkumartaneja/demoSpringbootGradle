/*
 * This build file was auto generated by running the Gradle 'init' task
 * by 'Peeyush' at '4/22/16 12:51 PM' with Gradle 2.5-rc-2
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at http://gradle.org/docs/2.5-rc-2/userguide/tutorial_java_projects.html
 */

 buildscript {
	 repositories {
		 mavenCentral()
	 }
	 dependencies {
		 classpath "org.springframework.boot:spring-boot-gradle-plugin:1.3.3.RELEASE"
		 // Less CSS classpath
		 classpath "de.obqo.gradle:gradle-lesscss-plugin:1.0-1.3.3"
	 }
 }
 
version =  '1.0'
 
// Apply the plugin 
apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'spring-boot'
apply plugin: 'lesscss'
apply plugin: 'war'
apply plugin: MyCustomPlugin


//new SimpleDateFormat("yyyy-MM-dd").format(new Date())

class MyCustomPlugin implements Plugin<Project> {
  public void apply(Project project) {
	project.task('myTask') {
	  project.gradle.projectsEvaluated {
		  
		  String fileName = "project.properties"
		  String intoPath = "src/main/resources/config"
		  ant.propertyfile(file: "${intoPath}/${fileName}") {
			  entry(key: "PROJECT_VERSION", value: project.version)
			  entry(key: "PROJECT_BUILD_DATE", value: new Date())
			  entry(key: "BUILD_NUMBER", value: hasProperty("teamcity") ? teamcity["build.number"] : "local")
		  }
				
	  }
	}
  }
}

sourceCompatibility = 1.8
targetCompatibility = 1.8

// war block specifies how the war file will be named
war {
	dependsOn 'lesscss'
	baseName = 'demoApp'
	version =  '1.0.0'
}

// In this section you declare where to find the dependencies of your project
repositories {
    // You can declare any Maven/Ivy/file repository here.
    mavenCentral()
}

// In this section you declare the dependencies for your App
dependencies {
	compile "org.springframework.boot:spring-boot-starter-thymeleaf"
    
	compile 'org.slf4j:slf4j-api'
	
	compile("org.springframework.boot:spring-boot-starter-web") {
        exclude module: "spring-boot-starter-tomcat"
    }
	
	compile "org.springframework.boot:spring-boot-starter-security"
	
	compile 'org.springframework:spring-context'
	compile 'org.springframework:spring-context-support'
	compile 'net.sf.ehcache:ehcache'
	
//	compile 'org.springframework:spring-context:4.1.4.RELEASE'
//	compile 'org.springframework:spring-context-support:4.1.4.RELEASE'
//	compile 'net.sf.ehcache:ehcache:2.9.0'
		
}


//Less CSS Plugin
lesscss {
	source = fileTree('src/main/webapp/assets/css') {
		include '*.less'
	}
	dest = 'src/main/webapp/assets/dist/css'
	compress = true
}

// https://spring.io/guides/gs/gradle/
task wrapper(type: Wrapper) {
	gradleVersion = '2.3'
}

